# 财务数据统计与聚类分析

——《大数据与商务智能》课程作业

## 1 数据集描述

- 132 只股票、31 个因素变量的 4 个年份数据记录，共528条记录
- 所给数据已作一致化和无量纲化处理，归一化到 [0,1]
- 原始数据保存在 `sourcedata.csv`

## 2 启动程序
### 配置环境

以 pip 为例：
```shell
pip install -r requirements.txt
```

也可以使用 conda 或手动安装所有依赖项

### 准备工作
#### 文件结构

- `data` 文件夹存放数据源及转换脚本
- `src` 文件夹存放所有数据分析与可视化代码，其中每个文件都包含一个或多个函数，以及其调用示例，在安装必要的依赖项以后可以直接运行

#### 数据源编码问题

- 由于原始数据 `sourcedata.csv` 可能使用 GBK 编码，为了防止中文乱码问题，需要转换为 UTF-8 编码
- 若 `rawdata.csv` 不存在，可以运行 `GBK_to_UTF8.py`，程序将生成并保存本工程需要用到的数据源文件 `rawdata.csv` ，输出一个 `rawdata.csv` 即为转换成功

### 运行程序
- 每个 `.py` 文件中都有一个或多个函数，其注释标注了函数的作用
- 可自行修改或添加函数调用代码

## 3 数据统计与聚类分析
### 3.1 数据统计

- 基本时间序列分析：`selected_timeseries.py`
  - 折线图
  - 对 132 支股票的连续 4 年数据，选取某一列绘制折线图
  - 折线较多可能出现折叠，主要观察数据整体趋势
  - 观察发现数据源中 2002 与 2003 两年数据有较大重叠
- 结合截面与时间序列分析：`selected_hist.py`
  - 频数分布直方图
  - 基础直方图函数 `plot_hist()` 
    - 选取某一年度，统计指定单个字段的频数分布
  - 堆叠直方图函数 `plot_years_hist()`
    - 堆叠多个年度，统计指定单个字段的频数分布
- 各维度相关性分析：`selected_hitmap.py`
  - 相关性热力图
  - 选取某个年度，计算多个选中字段直接的两两相关性
  - 根据得到的相关性矩阵，绘制热力图
- 字段特征分析：`selected_box_cross`
  - 箱线图
  - 指定多个字段，选取某一年度数据计算各字段统计特征
- 多维度截面分析：`selected_scatter_cross`
  - 散点气泡图
  - 选取某一年份，指定 2~4 个字段，使用每个散点/气泡代表一支股票信息
  - 二维散点图函数 `plot_2_dim_scatter(year)`
    - 指定 2 个字段分别映射到横轴、纵轴
  - 三维散点气泡图 `plot_3_dim_scatter(year)`
    - 指定 3 个字段，分别映射到横轴、纵轴、气泡大小
  - 彩色散点气泡图 `plot_4_dim_scatter(year)`
    - 指定 4 个字段，分别映射到横轴、纵轴、气泡大小、气泡颜色

### 3.2 聚类分析

选取某一年度数据，对所有 132 支股票进行 K 均值聚类，各函数位于 `k_mean_process.py`

#### 3.2.1 维度选择
配置 `X_prepared` 数组，设置需要进行聚类的 2~3 个数据维度字段

> 由于本项目聚类距离使用欧式距离计算，维度过高可能会出现 “维度灾难”，以及可视化困难等问题，因此用于聚类的维度不能过高，建议使用 2 维聚类

#### 3.2.2 K 值确定

- 肘部法则
  - 调用函数 `elbow_method_show(X)`
  - 该函数测试多个 K 值的误差平方和 (SSE) 后绘制出肘部图，图中 Distortion 值减小幅度趋于平稳的点即为 “肘点”
  - 选取一个合适的 “肘点”，对应 K 值可用于聚类
- 轮廓系数法
  - 调用函数 `silhouette_method_show(X)`
  - 该函数测试多个 K 值对应的轮廓系数以评估聚类的质量，绘制出折线图
  - 一个较高的轮廓系数表示聚类结果较好
- 结合肘部法则和轮廓系数，以及实际问题的需要，确定合适的 K 值

#### 3.2.3 K-means 聚类

- 非调库聚类函数 `k_means_sample_show(X, k_value)`
  - 调用助教所给 `kMeans(dataSet, k)` 函数完成聚类并绘图
- 二维聚类函数 `k_means_2d_show(X, k_value)`
  - 完成聚类并绘制出可视化气泡图
- 三维聚类函数 `k_means_3d_show(X, k_value)`
  - 完成聚类并绘制出三维可视化图

## 4 声明

本项目为 ZJU 2024 秋学期 《大数据与商务智能》 课程作业，数据来源均为课程网站，不涉及任何组织、实体或个人

项目由周一教学班第10小组完成

### Contributor

Wang Yujie,
Wang Linzi,
Shao Yunyi,
Fan Jiahui